---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
  .filter(p => !p.data.draft)
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout>
  <section class="pagehead">
    <div>
      <h1 class="page-title">Blog</h1>
      <p class="page-sub">Latest articles on AI, hosting, WordPress and design workflows.</p>
    </div>
    <a class="cta ghost" href="/">Back home</a>
  </section>

  {posts.length === 0 && <p>No posts yet.</p>}

  <div class="cards">
    {posts.map(post => (
      <article class="post-card">
        <h2 class="post-title">
          <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
        </h2>

        <p class="meta">
          {post.data.pubDate.toDateString()} ·
          <a class="meta-link" href={`/category/${post.data.category}/`}>{post.data.category}</a>
        </p>

        <p class="desc">{post.data.description}</p>

        <div class="tags">
          {post.data.tags?.slice(0, 4).map(t => (
            <a class="tag" href={`/tag/${t}/`}>#{t}</a>
          ))}
        </div>

        <div class="readmore">
          <a class="read" href={`/blog/${post.slug}/`}>Read article →</a>
        </div>
      </article>
    ))}
  </div>
</BaseLayout>
