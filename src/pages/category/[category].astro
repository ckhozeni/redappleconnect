---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const categories = [...new Set(posts.map(p => p.data.category))];
  return categories.map((category) => ({ params: { category } }));
}

const { category } = Astro.params;

const posts = (await getCollection("posts"))
  .filter(p => !p.data.draft && p.data.category === category)
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title={`Category: ${category} â€” Red Apple Connect`}>
  <h1>Category: {category}</h1>
  <p class="muted">Posts found: {posts.length}</p>

  {posts.length === 0 ? (
    <p>No posts in this category yet.</p>
  ) : (
    <ul>
      {posts.map(post => (
        <li style="margin: 10px 0;">
          <a href={`/blog/${post.slug}/`}><strong>{post.data.title}</strong></a>
          <div class="muted" style="font-size: 13px;">{post.data.description}</div>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
