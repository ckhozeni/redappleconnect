---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const tags = [...new Set(posts.flatMap(p => p.data.tags))];
  return tags.map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;

const posts = (await getCollection("posts"))
  .filter(p => !p.data.draft && p.data.tags.includes(tag))
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title={`Tag: ${tag} â€” Red Apple Connect`}>
  <h1>Tag: {tag}</h1>
  <p class="muted">Posts found: {posts.length}</p>

  {posts.length === 0 ? (
    <p>No posts with this tag yet.</p>
  ) : (
    <ul>
      {posts.map(post => (
        <li style="margin: 10px 0;">
          <a href={`/blog/${post.slug}/`}><strong>{post.data.title}</strong></a>
          <div class="muted" style="font-size: 13px;">{post.data.description}</div>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
